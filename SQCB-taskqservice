pipeline {
  agent {
    kubernetes {
      label 'jenkins-private-cluster-0'
      defaultContainer 'jnlp'
      yaml '''
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: python
    image: python:latest
    command:
    - sleep
    args:
    - 99d
    tty: true
  - name: gcloud
    image: gcr.io/cloud-builders/gcloud
    command:
    - sleep
    args:
    - 99d
    tty: true    
    '''
    }
  }
    environment {
        APP_ENGINE_PROJECT_ID = 'sqinternational-cicd'
        //APP_ENGINE_SERVICE = 'taskqservice'
        APP_ENGINE_VERSION = '1'
    }
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Deploy to Google Cloud Engine') {
            steps {
                container('gcloud') {
                    //sh 'gcloud auth list'
                    sh 'find . -type f -name "*.yaml"'
                    sh 'gcloud config set project $APP_ENGINE_PROJECT_ID'
                    sh 'gcloud app deploy --version=$APP_ENGINE_VERSION --quiet taskqservice.yaml --no-promote'
                }
            }
        }
    }
}